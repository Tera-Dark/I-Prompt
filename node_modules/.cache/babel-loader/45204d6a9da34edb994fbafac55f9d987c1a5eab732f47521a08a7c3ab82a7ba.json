{"ast":null,"code":"/**\n * ç®€åŒ–çš„å›¾åƒå…ƒæ•°æ®æå–å™¨\n * å‚è€ƒstable-diffusion-inspectorçš„å®ç°æ–¹å¼\n */// ä¸»è¦çš„æå–å‡½æ•°\nexport async function extractMetadata(file){console.log('ğŸš€ å¼€å§‹æå–å›¾åƒå…ƒæ•°æ®...');const result={success:false,filename:file.name,extractedData:{},standardizedData:null,timestamp:new Date().toISOString()};try{// åŸºæœ¬æ–‡ä»¶ä¿¡æ¯\nresult.basicInfo={size:file.size,sizeFormatted:\"\".concat((file.size/1024).toFixed(1),\" KB\"),type:file.type,lastModified:new Date(file.lastModified).toLocaleString()};// æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©æå–æ–¹æ³•\nif(file.type==='image/png'){const pngData=await extractFromPNG(file);if(pngData){result.extractedData.PNG=pngData;}}// å°è¯•EXIFæå–\ntry{const exifData=await extractFromEXIF(file);if(exifData){result.extractedData.EXIF=exifData;}}catch(error){console.warn('EXIFæå–å¤±è´¥:',error);}// æ ‡å‡†åŒ–æ•°æ®\nresult.standardizedData=standardizeData(result.extractedData);result.success=Object.keys(result.extractedData).length>0;// æ·»åŠ æå–æ–¹æ³•ä¿¡æ¯\nresult.extractionMethods=Object.keys(result.extractedData).map(method=>{var _result$extractedData;return{method:method,confidence:((_result$extractedData=result.extractedData[method])===null||_result$extractedData===void 0?void 0:_result$extractedData.confidence)||'unknown'};});return result;}catch(error){console.error('âŒ å…ƒæ•°æ®æå–å¤±è´¥:',error);result.error=error.message;throw error;}}// PNGæ–‡ä»¶è§£æ - å‚è€ƒstable-diffusion-inspectorçš„ç®€æ´å®ç°\nasync function extractFromPNG(file){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=e=>{try{const buffer=e.target.result;const chunks=parsePNGChunks(buffer);const metadata=extractMetadataFromChunks(chunks);resolve({type:'PNG',confidence:metadata.confidence||'medium',data:metadata});}catch(error){console.warn('PNGè§£æå¤±è´¥:',error);resolve(null);}};reader.onerror=()=>resolve(null);reader.readAsArrayBuffer(file);});}// ç®€åŒ–çš„PNGå—è§£æ\nfunction parsePNGChunks(buffer){const view=new DataView(buffer);const chunks=[];let offset=8;// è·³è¿‡PNGç­¾å\n// éªŒè¯PNGç­¾å\nconst signature=[0x89,0x50,0x4E,0x47,0x0D,0x0A,0x1A,0x0A];for(let i=0;i<8;i++){if(view.getUint8(i)!==signature[i]){throw new Error('ä¸æ˜¯æœ‰æ•ˆçš„PNGæ–‡ä»¶');}}while(offset<buffer.byteLength-8){try{const length=view.getUint32(offset);offset+=4;const type=String.fromCharCode(view.getUint8(offset),view.getUint8(offset+1),view.getUint8(offset+2),view.getUint8(offset+3));offset+=4;const data=new Uint8Array(buffer,offset,length);offset+=length;const crc=view.getUint32(offset);offset+=4;chunks.push({type,length,data,crc});if(type==='IEND')break;}catch(error){console.warn('PNGå—è§£æè­¦å‘Š:',error);break;}}return chunks;}// ä»PNGå—æå–å…ƒæ•°æ®\nfunction extractMetadataFromChunks(chunks){const textChunks=chunks.filter(chunk=>['tEXt','iTXt','zTXt'].includes(chunk.type));const metadata={confidence:'low',generationTool:'Unknown',positive:'',negative:'',parameters:{}};for(const chunk of textChunks){const textData=parseTextChunk(chunk);if(!textData.keyword||!textData.text)continue;console.log('è§£ææ–‡æœ¬å—:',textData.keyword,'é•¿åº¦:',textData.text.length);// æ£€æµ‹ä¸åŒæ ¼å¼\nif(textData.keyword==='parameters'&&isAutomatic1111Format(textData.text)){const parsed=parseAutomatic1111(textData.text);Object.assign(metadata,parsed);metadata.generationTool='AUTOMATIC1111';metadata.confidence='high';}else if(['workflow','prompt'].includes(textData.keyword)){try{const parsed=parseComfyUI(textData.text);Object.assign(metadata,parsed);metadata.generationTool='ComfyUI';metadata.confidence='high';}catch(error){console.warn('ComfyUIè§£æå¤±è´¥:',error);}}else if(['Description','Comment'].includes(textData.keyword)){try{const parsed=parseNovelAI(textData.text);Object.assign(metadata,parsed);metadata.generationTool='NovelAI';metadata.confidence='high';}catch(error){console.warn('NovelAIè§£æå¤±è´¥:',error);}}}return metadata;}// è§£ææ–‡æœ¬å—\nfunction parseTextChunk(chunk){try{const data=chunk.data;if(chunk.type==='tEXt'){const nullIndex=data.indexOf(0);if(nullIndex===-1)return{};const keyword=decodeLatin1(data.slice(0,nullIndex));const text=decodeLatin1(data.slice(nullIndex+1));return{keyword,text};}if(chunk.type==='iTXt'){const nullIndices=[];for(let i=0;i<data.length;i++){if(data[i]===0){nullIndices.push(i);if(nullIndices.length>=4)break;}}if(nullIndices.length<4)return{};const keyword=decodeUTF8(data.slice(0,nullIndices[0]));const text=decodeUTF8(data.slice(nullIndices[3]+1));return{keyword,text};}return{};}catch(error){console.warn('æ–‡æœ¬å—è§£æå¤±è´¥:',error);return{};}}// å®‰å…¨çš„å­—ç¬¦è§£ç \nfunction decodeLatin1(data){let result='';for(let i=0;i<data.length;i++){result+=String.fromCharCode(data[i]);}return result;}function decodeUTF8(data){try{return new TextDecoder('utf-8',{fatal:false}).decode(data);}catch(error){return decodeLatin1(data);}}// æ£€æµ‹AUTOMATIC1111æ ¼å¼\nfunction isAutomatic1111Format(text){const lowerText=text.toLowerCase();return lowerText.includes('steps:')||lowerText.includes('cfg scale:')||lowerText.includes('sampler:')||lowerText.includes('negative prompt:');}// è§£æAUTOMATIC1111æ•°æ®\nfunction parseAutomatic1111(text){const result={positive:'',negative:'',parameters:{}};try{const negativeIndex=text.indexOf('Negative prompt:');if(negativeIndex!==-1){result.positive=text.substring(0,negativeIndex).trim();const afterNegative=text.substring(negativeIndex+16);const lines=afterNegative.split('\\n');let negativePrompt='';let parameterLines=[];let foundParams=false;for(const line of lines){const trimmed=line.trim();if(isParameterLine(trimmed)){foundParams=true;parameterLines.push(trimmed);}else if(!foundParams&&trimmed){negativePrompt+=(negativePrompt?'\\n':'')+trimmed;}else if(foundParams){parameterLines.push(trimmed);}}result.negative=negativePrompt.trim();if(parameterLines.length>0){result.parameters=parseParameters(parameterLines.join(', '));}}else{// æ²¡æœ‰è´Ÿå‘æç¤ºè¯çš„æƒ…å†µ\nconst lines=text.split('\\n');let positiveLines=[];let parameterLines=[];let foundParams=false;for(const line of lines){const trimmed=line.trim();if(isParameterLine(trimmed)){foundParams=true;parameterLines.push(trimmed);}else if(!foundParams&&trimmed){positiveLines.push(trimmed);}else if(foundParams){parameterLines.push(trimmed);}}result.positive=positiveLines.join(' ').trim();if(parameterLines.length>0){result.parameters=parseParameters(parameterLines.join(', '));}}}catch(error){console.warn('AUTOMATIC1111è§£æè­¦å‘Š:',error);result.positive=text;}return result;}// æ£€æµ‹å‚æ•°è¡Œ\nfunction isParameterLine(line){return /\\b(Steps|Sampler|CFG scale|Seed|Size|Model):/i.test(line);}// è§£æå‚æ•°\nfunction parseParameters(paramText){const parameters={};const regex=/(\\w+(?:\\s+\\w+)*)\\s*:\\s*([^,]+?)(?=,\\s*\\w+\\s*:|$)/g;let match;while((match=regex.exec(paramText))!==null){const key=match[1].trim().toLowerCase().replace(/\\s+/g,'');const value=match[2].trim();const numValue=parseFloat(value);parameters[key]=!isNaN(numValue)&&isFinite(numValue)?numValue:value;}return parameters;}// è§£æComfyUIæ•°æ®\nfunction parseComfyUI(text){const result={positive:'',negative:'',parameters:{}};try{const data=JSON.parse(text);if(Array.isArray(data===null||data===void 0?void 0:data.nodes)){// å·¥ä½œæµæ ¼å¼\nconsole.log('ğŸ“‹ æ£€æµ‹åˆ°ComfyUIå·¥ä½œæµæ ¼å¼');const prompts=extractFromComfyWorkflow(data);result.positive=prompts.positive;result.negative=prompts.negative;Object.assign(result.parameters,prompts.parameters);}else if(typeof data==='object'){// æç¤ºæ ¼å¼\nconsole.log('ğŸ“‹ æ£€æµ‹åˆ°ComfyUIæç¤ºæ ¼å¼');const prompts=extractFromComfyPrompt(data);result.positive=prompts.positive;result.negative=prompts.negative;Object.assign(result.parameters,prompts.parameters);}// å¦‚æœæ²¡æœ‰æå–åˆ°æç¤ºè¯ï¼Œå°è¯•æ·±åº¦æœç´¢\nif(!result.positive&&!result.negative){console.log('ğŸ” å¼€å§‹æ·±åº¦æœç´¢æç¤ºè¯...');const deepSearch=deepSearchPrompts(data);result.positive=deepSearch.positive;result.negative=deepSearch.negative;Object.assign(result.parameters,deepSearch.parameters);}}catch(error){console.warn('ComfyUIè§£æå¤±è´¥:',error);}return result;}// æ·±åº¦æœç´¢æç¤ºè¯ï¼ˆç”¨äºå¤æ‚å·¥ä½œæµï¼‰\nfunction deepSearchPrompts(data){const result={positive:'',negative:'',parameters:{}};const allTexts=[];// é€’å½’æœç´¢æ‰€æœ‰å¯èƒ½åŒ…å«æ–‡æœ¬çš„å­—æ®µ\nfunction searchObject(obj){let path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';if(typeof obj==='string'&&obj.trim().length>10){// è¿‡æ»¤æ‰æ˜æ˜¾ä¸æ˜¯æç¤ºè¯çš„æ–‡æœ¬\nif(!isSystemText(obj)){allTexts.push({text:obj.trim(),path:path,length:obj.trim().length});console.log(\"\\uD83D\\uDD0D \\u53D1\\u73B0\\u6587\\u672C (\".concat(path,\"): \").concat(obj.substring(0,50),\"...\"));}}else if(Array.isArray(obj)){obj.forEach((item,index)=>{searchObject(item,\"\".concat(path,\"[\").concat(index,\"]\"));});}else if(typeof obj==='object'&&obj!==null){Object.entries(obj).forEach(_ref=>{let[key,value]=_ref;// é‡ç‚¹å…³æ³¨å¯èƒ½åŒ…å«æç¤ºè¯çš„å­—æ®µ\nconst importantKeys=['text','prompt','string','content','value','input','output'];const newPath=importantKeys.includes(key.toLowerCase())?\"\".concat(path,\".\").concat(key,\"*\"):\"\".concat(path,\".\").concat(key);searchObject(value,newPath);});}}searchObject(data);// æŒ‰é•¿åº¦æ’åºï¼Œä¼˜å…ˆå¤„ç†è¾ƒé•¿çš„æ–‡æœ¬ï¼ˆå¯èƒ½æ˜¯æœ€ç»ˆç»“æœï¼‰\nallTexts.sort((a,b)=>b.length-a.length);console.log(\"\\uD83C\\uDFAF \\u5171\\u53D1\\u73B0 \".concat(allTexts.length,\" \\u4E2A\\u6587\\u672C\\u7247\\u6BB5\"));// æ™ºèƒ½åˆ†ç±»æ–‡æœ¬\nconst positiveTexts=[];const negativeTexts=[];for(const textObj of allTexts){const text=textObj.text;// è·³è¿‡é‡å¤çš„æ–‡æœ¬\nif(positiveTexts.some(t=>t.includes(text)||text.includes(t))||negativeTexts.some(t=>t.includes(text)||text.includes(t))){continue;}if(isNegativePrompt(text)){negativeTexts.push(text);console.log(\"\\u2796 \\u5206\\u7C7B\\u4E3A\\u8D1F\\u5411: \".concat(text.substring(0,30),\"...\"));}else{positiveTexts.push(text);console.log(\"\\u2795 \\u5206\\u7C7B\\u4E3A\\u6B63\\u5411: \".concat(text.substring(0,30),\"...\"));}}// é€‰æ‹©æœ€ä½³æ–‡æœ¬\nresult.positive=selectBestPrompt(positiveTexts);result.negative=selectBestPrompt(negativeTexts);return result;}// åˆ¤æ–­æ˜¯å¦ä¸ºç³»ç»Ÿæ–‡æœ¬ï¼ˆéæç¤ºè¯ï¼‰\nfunction isSystemText(text){const systemPatterns=[/^[a-f0-9]{8,}$/i,// å“ˆå¸Œå€¼\n/^\\d+\\.\\d+\\.\\d+/,// ç‰ˆæœ¬å·\n/^https?:\\/\\//,// URL\n/^[A-Z_]+$/,// å…¨å¤§å†™å¸¸é‡\n/^\\w+\\.(png|jpg|jpeg|webp|gif)$/i,// æ–‡ä»¶å\n/^(true|false|null|undefined)$/i,// å¸ƒå°”å€¼\n/^\\d+x\\d+$/,// å°ºå¯¸\n/^#[a-f0-9]{6}$/i// é¢œè‰²ä»£ç \n];return systemPatterns.some(pattern=>pattern.test(text.trim()));}// é€‰æ‹©æœ€ä½³æç¤ºè¯\nfunction selectBestPrompt(texts){if(texts.length===0)return'';if(texts.length===1)return texts[0];// è¯„åˆ†ç³»ç»Ÿ\nconst scoredTexts=texts.map(text=>{let score=0;// é•¿åº¦åŠ åˆ†ï¼ˆä½†ä¸æ˜¯è¶Šé•¿è¶Šå¥½ï¼‰\nconst idealLength=200;const lengthScore=Math.max(0,1-Math.abs(text.length-idealLength)/idealLength);score+=lengthScore*0.3;// é€—å·æ•°é‡åŠ åˆ†ï¼ˆè¡¨ç¤ºæ ‡ç­¾ä¸°å¯Œåº¦ï¼‰\nconst commaCount=(text.match(/,/g)||[]).length;score+=Math.min(commaCount/10,1)*0.2;// åŒ…å«è´¨é‡è¯åŠ åˆ†\nconst qualityWords=['masterpiece','best quality','high quality','detailed','professional'];const qualityScore=qualityWords.filter(word=>text.toLowerCase().includes(word)).length/qualityWords.length;score+=qualityScore*0.2;// åŒ…å«è‰ºæœ¯é£æ ¼è¯åŠ åˆ†\nconst styleWords=['anime','realistic','painting','illustration','digital art','concept art'];const styleScore=styleWords.filter(word=>text.toLowerCase().includes(word)).length/styleWords.length;score+=styleScore*0.1;// é¿å…é‡å¤è¯æ±‡\nconst words=text.toLowerCase().split(/\\s+/);const uniqueWords=new Set(words);const uniqueRatio=uniqueWords.size/words.length;score+=uniqueRatio*0.2;return{text,score};});// é€‰æ‹©å¾—åˆ†æœ€é«˜çš„\nscoredTexts.sort((a,b)=>b.score-a.score);const best=scoredTexts[0];console.log(\"\\uD83C\\uDFC6 \\u9009\\u62E9\\u6700\\u4F73\\u63D0\\u793A\\u8BCD (\\u5F97\\u5206: \".concat(best.score.toFixed(2),\"): \").concat(best.text.substring(0,50),\"...\"));return best.text;}// ä»ComfyUIå·¥ä½œæµæå–\nfunction extractFromComfyWorkflow(workflow){var _workflow$nodes;const positivePrompts=[];const negativePrompts=[];const parameters={};console.log('ğŸ” åˆ†æComfyUIå·¥ä½œæµï¼ŒèŠ‚ç‚¹æ•°é‡:',((_workflow$nodes=workflow.nodes)===null||_workflow$nodes===void 0?void 0:_workflow$nodes.length)||0);for(const node of workflow.nodes||[]){console.log(\"\\uD83D\\uDCDD \\u68C0\\u67E5\\u8282\\u70B9: \".concat(node.type,\" (\").concat(node.title||'untitled',\")\"));// æ‰©å±•æ”¯æŒçš„æ–‡æœ¬ç¼–ç èŠ‚ç‚¹ç±»å‹\nconst textEncoderTypes=['CLIPTextEncode','CLIPTextEncodeSDXL','BNK_CLIPTextEncoder',// BNKç³»åˆ—èŠ‚ç‚¹\n'WeiLin-ComfyUI-prompt-all-in-one',// WeiLinæ’ä»¶\n'TIPO',// TIPOèŠ‚ç‚¹\n'PromptWithStyle',// æ ·å¼æç¤ºè¯èŠ‚ç‚¹\n'StringFunction',// å­—ç¬¦ä¸²å¤„ç†èŠ‚ç‚¹\n'Text',// é€šç”¨æ–‡æœ¬èŠ‚ç‚¹\n'TextInput',// æ–‡æœ¬è¾“å…¥èŠ‚ç‚¹\n'PromptBuilder',// æç¤ºè¯æ„å»ºå™¨\n'AdvancedCLIPTextEncode',// é«˜çº§CLIPç¼–ç å™¨\n'CLIPTextEncodeFlux',// Fluxæ¨¡å‹ç¼–ç å™¨\n'ShowText',// æ˜¾ç¤ºæ–‡æœ¬èŠ‚ç‚¹\n'StringConstant',// å­—ç¬¦ä¸²å¸¸é‡\n'MultilineStringLiteral'// å¤šè¡Œå­—ç¬¦ä¸²\n];if(textEncoderTypes.includes(node.type)){console.log(\"\\u2705 \\u627E\\u5230\\u6587\\u672C\\u7F16\\u7801\\u8282\\u70B9: \".concat(node.type));// å°è¯•å¤šç§æ–¹å¼è·å–æ–‡æœ¬å†…å®¹\nlet text=null;// æ–¹å¼1: widgets_valuesæ•°ç»„\nif(node.widgets_values&&Array.isArray(node.widgets_values)){for(const value of node.widgets_values){if(typeof value==='string'&&value.trim().length>0){text=value.trim();console.log(\"\\uD83D\\uDCC4 \\u4ECEwidgets_values\\u83B7\\u53D6\\u6587\\u672C: \".concat(text.substring(0,50),\"...\"));break;}}}// æ–¹å¼2: ç›´æ¥çš„textå±æ€§\nif(!text&&node.text&&typeof node.text==='string'){text=node.text.trim();console.log(\"\\uD83D\\uDCC4 \\u4ECEtext\\u5C5E\\u6027\\u83B7\\u53D6\\u6587\\u672C: \".concat(text.substring(0,50),\"...\"));}// æ–¹å¼3: inputsä¸­çš„text\nif(!text&&node.inputs){for(const input of node.inputs){if(input.name==='text'&&input.widget&&input.widget.value){text=input.widget.value.trim();console.log(\"\\uD83D\\uDCC4 \\u4ECEinputs\\u83B7\\u53D6\\u6587\\u672C: \".concat(text.substring(0,50),\"...\"));break;}}}// æ–¹å¼4: propertiesä¸­æŸ¥æ‰¾\nif(!text&&node.properties){if(node.properties.text){text=node.properties.text.trim();console.log(\"\\uD83D\\uDCC4 \\u4ECEproperties\\u83B7\\u53D6\\u6587\\u672C: \".concat(text.substring(0,50),\"...\"));}}if(text&&text.length>0){var _node$title,_node$title2,_node$title3;// æ™ºèƒ½åˆ¤æ–­æ˜¯å¦ä¸ºè´Ÿå‘æç¤ºè¯\nconst isNegative=isNegativePrompt(text)||((_node$title=node.title)===null||_node$title===void 0?void 0:_node$title.toLowerCase().includes('negative'))||((_node$title2=node.title)===null||_node$title2===void 0?void 0:_node$title2.toLowerCase().includes('è´Ÿå‘'))||((_node$title3=node.title)===null||_node$title3===void 0?void 0:_node$title3.toLowerCase().includes('åå‘'))||node.color&&(node.color==='#ff6b6b'||node.color==='#e74c3c');// çº¢è‰²é€šå¸¸è¡¨ç¤ºè´Ÿå‘\nif(isNegative){negativePrompts.push(text);console.log(\"\\u2796 \\u8BC6\\u522B\\u4E3A\\u8D1F\\u5411\\u63D0\\u793A\\u8BCD: \".concat(text.substring(0,30),\"...\"));}else{positivePrompts.push(text);console.log(\"\\u2795 \\u8BC6\\u522B\\u4E3A\\u6B63\\u5411\\u63D0\\u793A\\u8BCD: \".concat(text.substring(0,30),\"...\"));}}}// æå–é‡‡æ ·å™¨å‚æ•°\nif(['KSampler','KSamplerAdvanced','SamplerCustom'].includes(node.type)){if(node.widgets_values){const[seed,steps,cfg,sampler_name,scheduler,denoise]=node.widgets_values;if(seed!==undefined)parameters.seed=seed;if(steps!==undefined)parameters.steps=steps;if(cfg!==undefined)parameters.cfg_scale=cfg;if(sampler_name!==undefined)parameters.sampler=sampler_name;if(scheduler!==undefined)parameters.scheduler=scheduler;if(denoise!==undefined)parameters.denoise=denoise;console.log(\"\\u2699\\uFE0F \\u63D0\\u53D6\\u91C7\\u6837\\u5668\\u53C2\\u6570: steps=\".concat(steps,\", cfg=\").concat(cfg,\", sampler=\").concat(sampler_name));}}// æå–æ¨¡å‹ä¿¡æ¯\nif(['CheckpointLoaderSimple','CheckpointLoader'].includes(node.type)){if(node.widgets_values&&node.widgets_values[0]){parameters.model=node.widgets_values[0];console.log(\"\\uD83C\\uDFAF \\u63D0\\u53D6\\u6A21\\u578B: \".concat(parameters.model));}}// æå–å›¾åƒå°ºå¯¸\nif(['EmptyLatentImage','LatentUpscale'].includes(node.type)){if(node.widgets_values){const[width,height]=node.widgets_values;if(width!==undefined)parameters.width=width;if(height!==undefined)parameters.height=height;console.log(\"\\uD83D\\uDCD0 \\u63D0\\u53D6\\u5C3A\\u5BF8: \".concat(width,\"x\").concat(height));}}}// æ™ºèƒ½åˆå¹¶æç¤ºè¯\nconst finalPositive=smartMergePrompts(positivePrompts);const finalNegative=smartMergePrompts(negativePrompts);console.log(\"\\uD83C\\uDFAF \\u6700\\u7EC8\\u7ED3\\u679C: \\u6B63\\u5411\\u63D0\\u793A\\u8BCD\".concat(finalPositive.length,\"\\u5B57\\u7B26, \\u8D1F\\u5411\\u63D0\\u793A\\u8BCD\").concat(finalNegative.length,\"\\u5B57\\u7B26\"));return{positive:finalPositive,negative:finalNegative,parameters};}// æ™ºèƒ½åˆå¹¶æç¤ºè¯\nfunction smartMergePrompts(prompts){if(prompts.length===0)return'';if(prompts.length===1)return prompts[0];// å»é‡å¹¶æŒ‰é•¿åº¦æ’åºï¼Œä¼˜å…ˆé€‰æ‹©æ›´å®Œæ•´çš„æç¤ºè¯\nconst uniquePrompts=[...new Set(prompts)];uniquePrompts.sort((a,b)=>b.length-a.length);// å¦‚æœæœ€é•¿çš„æç¤ºè¯æ˜æ˜¾æ¯”å…¶ä»–çš„é•¿å¾ˆå¤šï¼Œå¯èƒ½æ˜¯æœ€ç»ˆåˆæˆçš„ç»“æœ\nconst longest=uniquePrompts[0];const secondLongest=uniquePrompts[1]||'';if(longest.length>secondLongest.length*2){console.log(\"\\uD83C\\uDFAF \\u9009\\u62E9\\u6700\\u957F\\u63D0\\u793A\\u8BCD\\u4F5C\\u4E3A\\u6700\\u7EC8\\u7ED3\\u679C: \".concat(longest.length,\" vs \").concat(secondLongest.length));return longest;}// å¦åˆ™åˆå¹¶æ‰€æœ‰å”¯ä¸€çš„æç¤ºè¯\nreturn uniquePrompts.join(', ');}// ä»ComfyUIæç¤ºæå–\nfunction extractFromComfyPrompt(prompt){const positivePrompts=[];const negativePrompts=[];const parameters={};console.log('ğŸ” åˆ†æComfyUIæç¤ºæ ¼å¼ï¼ŒèŠ‚ç‚¹æ•°é‡:',Object.keys(prompt).length);for(const[nodeId,nodeData]of Object.entries(prompt)){console.log(\"\\uD83D\\uDCDD \\u68C0\\u67E5\\u8282\\u70B9 \".concat(nodeId,\": \").concat(nodeData.class_type));// æ‰©å±•æ”¯æŒçš„èŠ‚ç‚¹ç±»å‹\nconst textEncoderTypes=['CLIPTextEncode','CLIPTextEncodeSDXL','BNK_CLIPTextEncoder','WeiLin-ComfyUI-prompt-all-in-one','TIPO','PromptWithStyle','StringFunction','Text','TextInput','PromptBuilder','AdvancedCLIPTextEncode','CLIPTextEncodeFlux','ShowText','StringConstant','MultilineStringLiteral'];if(textEncoderTypes.includes(nodeData.class_type)){var _nodeData$inputs,_nodeData$inputs2,_nodeData$inputs3;console.log(\"\\u2705 \\u627E\\u5230\\u6587\\u672C\\u7F16\\u7801\\u8282\\u70B9: \".concat(nodeData.class_type));// å°è¯•å¤šç§æ–¹å¼è·å–æ–‡æœ¬\nlet text=null;if((_nodeData$inputs=nodeData.inputs)!==null&&_nodeData$inputs!==void 0&&_nodeData$inputs.text&&typeof nodeData.inputs.text==='string'){text=nodeData.inputs.text.trim();console.log(\"\\uD83D\\uDCC4 \\u4ECEinputs.text\\u83B7\\u53D6: \".concat(text.substring(0,50),\"...\"));}else if((_nodeData$inputs2=nodeData.inputs)!==null&&_nodeData$inputs2!==void 0&&_nodeData$inputs2.prompt&&typeof nodeData.inputs.prompt==='string'){text=nodeData.inputs.prompt.trim();console.log(\"\\uD83D\\uDCC4 \\u4ECEinputs.prompt\\u83B7\\u53D6: \".concat(text.substring(0,50),\"...\"));}else if((_nodeData$inputs3=nodeData.inputs)!==null&&_nodeData$inputs3!==void 0&&_nodeData$inputs3.string&&typeof nodeData.inputs.string==='string'){text=nodeData.inputs.string.trim();console.log(\"\\uD83D\\uDCC4 \\u4ECEinputs.string\\u83B7\\u53D6: \".concat(text.substring(0,50),\"...\"));}if(text&&text.length>0){if(isNegativePrompt(text)){negativePrompts.push(text);console.log(\"\\u2796 \\u8BC6\\u522B\\u4E3A\\u8D1F\\u5411\\u63D0\\u793A\\u8BCD\");}else{positivePrompts.push(text);console.log(\"\\u2795 \\u8BC6\\u522B\\u4E3A\\u6B63\\u5411\\u63D0\\u793A\\u8BCD\");}}}// æå–å…¶ä»–å‚æ•°...\nif(['KSampler','KSamplerAdvanced','SamplerCustom'].includes(nodeData.class_type)){const inputs=nodeData.inputs;if(inputs.seed!==undefined)parameters.seed=inputs.seed;if(inputs.steps!==undefined)parameters.steps=inputs.steps;if(inputs.cfg!==undefined)parameters.cfg_scale=inputs.cfg;if(inputs.sampler_name!==undefined)parameters.sampler=inputs.sampler_name;if(inputs.scheduler!==undefined)parameters.scheduler=inputs.scheduler;if(inputs.denoise!==undefined)parameters.denoise=inputs.denoise;}}const finalPositive=smartMergePrompts(positivePrompts);const finalNegative=smartMergePrompts(negativePrompts);console.log(\"\\uD83C\\uDFAF \\u6700\\u7EC8\\u7ED3\\u679C: \\u6B63\\u5411\\u63D0\\u793A\\u8BCD\".concat(finalPositive.length,\"\\u5B57\\u7B26, \\u8D1F\\u5411\\u63D0\\u793A\\u8BCD\").concat(finalNegative.length,\"\\u5B57\\u7B26\"));return{positive:finalPositive,negative:finalNegative,parameters};}// æ£€æµ‹è´Ÿå‘æç¤ºè¯\nfunction isNegativePrompt(text){const lowerText=text.toLowerCase();// æ‰©å±•è´Ÿå‘å…³é”®è¯åˆ—è¡¨\nconst negativeKeywords=[// è´¨é‡ç›¸å…³\n'worst quality','bad quality','low quality','poor quality','bad anatomy','bad proportions','bad hands','bad fingers','ugly','deformed','disfigured','mutated','malformed','blurry','blur','out of focus','unfocused','soft focus','lowres','low resolution','pixelated','jpeg artifacts',// æŠ€æœ¯é—®é¢˜\n'error','glitch','artifact','noise','grain','distorted','cropped','cut off','truncated','incomplete','watermark','signature','text','logo','username','border','frame','black bars','letterbox',// è§£å‰–é—®é¢˜\n'extra limbs','missing limbs','extra fingers','missing fingers','extra arms','extra legs','fused fingers','too many fingers','long neck','long body','elongated','stretched','duplicate','multiple','conjoined','merged',// é£æ ¼é—®é¢˜\n'amateur','sketch','draft','unfinished','rough','simple','basic','plain','boring','dull','monochrome','grayscale','black and white','sepia',// å†…å®¹é—®é¢˜\n'nsfw','nude','naked','explicit','sexual','violence','blood','gore','disturbing','scary','dark','horror','nightmare','creepy','evil',// ä¸­æ–‡è´Ÿå‘è¯\n'æœ€å·®è´¨é‡','ç³Ÿç³•è´¨é‡','ä½è´¨é‡','å·®è´¨é‡','ç³Ÿç³•è§£å‰–','å˜å½¢','ç•¸å½¢','ä¸‘é™‹','æ¨¡ç³Š','ä½åˆ†è¾¨ç‡','åƒç´ åŒ–','å™ªç‚¹','ä¼ªå½±','æ°´å°','ç­¾å','æ–‡å­—','æ ‡å¿—','ç”¨æˆ·å','å¤šä½™çš„','ç¼ºå¤±çš„','èåˆçš„','é‡å¤çš„','ä¸šä½™','è‰å›¾','æœªå®Œæˆ','ç²—ç³™','ç®€å•','å•è‰²','ç°åº¦','é»‘ç™½','æš—è‰²è°ƒ'];// æ£€æŸ¥æ˜¯å¦åŒ…å«è´Ÿå‘å…³é”®è¯\nconst hasNegativeKeywords=negativeKeywords.some(keyword=>lowerText.includes(keyword.toLowerCase()));// æ£€æŸ¥è´Ÿå‘æç¤ºè¯çš„æ¯”ä¾‹\nconst negativeWordCount=negativeKeywords.filter(keyword=>lowerText.includes(keyword.toLowerCase())).length;const totalWords=text.split(/\\s+/).length;const negativeRatio=negativeWordCount/totalWords;// å¦‚æœè´Ÿå‘è¯æ±‡æ¯”ä¾‹è¶…è¿‡30%ï¼Œå¾ˆå¯èƒ½æ˜¯è´Ÿå‘æç¤ºè¯\nconst isHighNegativeRatio=negativeRatio>0.3;// æ£€æŸ¥æ˜¯å¦ä»¥è´Ÿå‘è¯å¼€å¤´\nconst startsWithNegative=negativeKeywords.some(keyword=>lowerText.startsWith(keyword.toLowerCase()));console.log(\"\\uD83D\\uDD0D \\u8D1F\\u5411\\u68C0\\u6D4B: \\u5173\\u952E\\u8BCD=\".concat(hasNegativeKeywords,\", \\u6BD4\\u4F8B=\").concat(negativeRatio.toFixed(2),\", \\u5F00\\u5934=\").concat(startsWithNegative));return hasNegativeKeywords||isHighNegativeRatio||startsWithNegative;}// è§£æNovelAIæ•°æ®\nfunction parseNovelAI(text){const result={positive:'',negative:'',parameters:{}};try{const data=JSON.parse(text);result.positive=data.prompt||'';result.negative=data.uc||'';['steps','scale','seed','sampler','width','height'].forEach(key=>{if(data[key]!==undefined){result.parameters[key]=data[key];}});}catch(error){console.warn('NovelAIè§£æå¤±è´¥:',error);}return result;}// EXIFæ•°æ®æå–\nasync function extractFromEXIF(file){try{// åŠ¨æ€å¯¼å…¥exifr\nconst exifr=await import('exifr');const exifData=await exifr.parse(file,{userComment:true,imageDescription:true,software:true});if(!exifData)return null;return{type:'EXIF',confidence:'medium',data:{software:exifData.Software,description:exifData.ImageDescription,userComment:exifData.UserComment,positive:exifData.UserComment||exifData.ImageDescription||'',negative:'',parameters:{}}};}catch(error){console.warn('EXIFæå–å¤±è´¥:',error);return null;}}// æ ‡å‡†åŒ–æ•°æ®\nfunction standardizeData(extractedData){const standardized={generationTool:'Unknown',positive:'',negative:'',parameters:{}};// ä¼˜å…ˆçº§é¡ºåº\nconst sources=['PNG','EXIF'];for(const source of sources){const data=extractedData[source];if(!data)continue;if(data.data.generationTool){standardized.generationTool=data.data.generationTool;}if(data.data.positive&&!standardized.positive){standardized.positive=data.data.positive;}if(data.data.negative&&!standardized.negative){standardized.negative=data.data.negative;}Object.assign(standardized.parameters,data.data.parameters||{});}return standardized;}// å¯¼å‡ºä¸»è¦å‡½æ•°\nexport const imageMetadataExtractor={extractMetadata};export default imageMetadataExtractor;","map":{"version":3,"names":["extractMetadata","file","console","log","result","success","filename","name","extractedData","standardizedData","timestamp","Date","toISOString","basicInfo","size","sizeFormatted","concat","toFixed","type","lastModified","toLocaleString","pngData","extractFromPNG","PNG","exifData","extractFromEXIF","EXIF","error","warn","standardizeData","Object","keys","length","extractionMethods","map","method","_result$extractedData","confidence","message","Promise","resolve","reject","reader","FileReader","onload","e","buffer","target","chunks","parsePNGChunks","metadata","extractMetadataFromChunks","data","onerror","readAsArrayBuffer","view","DataView","offset","signature","i","getUint8","Error","byteLength","getUint32","String","fromCharCode","Uint8Array","crc","push","textChunks","filter","chunk","includes","generationTool","positive","negative","parameters","textData","parseTextChunk","keyword","text","isAutomatic1111Format","parsed","parseAutomatic1111","assign","parseComfyUI","parseNovelAI","nullIndex","indexOf","decodeLatin1","slice","nullIndices","decodeUTF8","TextDecoder","fatal","decode","lowerText","toLowerCase","negativeIndex","substring","trim","afterNegative","lines","split","negativePrompt","parameterLines","foundParams","line","trimmed","isParameterLine","parseParameters","join","positiveLines","test","paramText","regex","match","exec","key","replace","value","numValue","parseFloat","isNaN","isFinite","JSON","parse","Array","isArray","nodes","prompts","extractFromComfyWorkflow","extractFromComfyPrompt","deepSearch","deepSearchPrompts","allTexts","searchObject","obj","path","arguments","undefined","isSystemText","forEach","item","index","entries","_ref","importantKeys","newPath","sort","a","b","positiveTexts","negativeTexts","textObj","some","t","isNegativePrompt","selectBestPrompt","systemPatterns","pattern","texts","scoredTexts","score","idealLength","lengthScore","Math","max","abs","commaCount","min","qualityWords","qualityScore","word","styleWords","styleScore","words","uniqueWords","Set","uniqueRatio","best","workflow","_workflow$nodes","positivePrompts","negativePrompts","node","title","textEncoderTypes","widgets_values","inputs","input","widget","properties","_node$title","_node$title2","_node$title3","isNegative","color","seed","steps","cfg","sampler_name","scheduler","denoise","cfg_scale","sampler","model","width","height","finalPositive","smartMergePrompts","finalNegative","uniquePrompts","longest","secondLongest","prompt","nodeId","nodeData","class_type","_nodeData$inputs","_nodeData$inputs2","_nodeData$inputs3","string","negativeKeywords","hasNegativeKeywords","negativeWordCount","totalWords","negativeRatio","isHighNegativeRatio","startsWithNegative","startsWith","uc","exifr","userComment","imageDescription","software","Software","description","ImageDescription","UserComment","standardized","sources","source","imageMetadataExtractor"],"sources":["C:/Users/wjx19/Documents/GitHub/I-Prompt/src/utils/imageMetadataExtractor.js"],"sourcesContent":["/**\n * ç®€åŒ–çš„å›¾åƒå…ƒæ•°æ®æå–å™¨\n * å‚è€ƒstable-diffusion-inspectorçš„å®ç°æ–¹å¼\n */\n\n// ä¸»è¦çš„æå–å‡½æ•°\nexport async function extractMetadata(file) {\n  console.log('ğŸš€ å¼€å§‹æå–å›¾åƒå…ƒæ•°æ®...');\n  \n  const result = {\n    success: false,\n    filename: file.name,\n    extractedData: {},\n    standardizedData: null,\n    timestamp: new Date().toISOString()\n  };\n\n  try {\n    // åŸºæœ¬æ–‡ä»¶ä¿¡æ¯\n    result.basicInfo = {\n      size: file.size,\n      sizeFormatted: `${(file.size / 1024).toFixed(1)} KB`,\n      type: file.type,\n      lastModified: new Date(file.lastModified).toLocaleString()\n    };\n\n    // æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©æå–æ–¹æ³•\n    if (file.type === 'image/png') {\n      const pngData = await extractFromPNG(file);\n      if (pngData) {\n        result.extractedData.PNG = pngData;\n      }\n    }\n\n    // å°è¯•EXIFæå–\n    try {\n      const exifData = await extractFromEXIF(file);\n      if (exifData) {\n        result.extractedData.EXIF = exifData;\n      }\n    } catch (error) {\n      console.warn('EXIFæå–å¤±è´¥:', error);\n    }\n\n    // æ ‡å‡†åŒ–æ•°æ®\n    result.standardizedData = standardizeData(result.extractedData);\n    result.success = Object.keys(result.extractedData).length > 0;\n\n    // æ·»åŠ æå–æ–¹æ³•ä¿¡æ¯\n    result.extractionMethods = Object.keys(result.extractedData).map(method => ({\n      method: method,\n      confidence: result.extractedData[method]?.confidence || 'unknown'\n    }));\n\n    return result;\n    \n  } catch (error) {\n    console.error('âŒ å…ƒæ•°æ®æå–å¤±è´¥:', error);\n    result.error = error.message;\n    throw error;\n  }\n}\n\n// PNGæ–‡ä»¶è§£æ - å‚è€ƒstable-diffusion-inspectorçš„ç®€æ´å®ç°\nasync function extractFromPNG(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    \n    reader.onload = (e) => {\n      try {\n        const buffer = e.target.result;\n        const chunks = parsePNGChunks(buffer);\n        const metadata = extractMetadataFromChunks(chunks);\n        \n        resolve({\n          type: 'PNG',\n          confidence: metadata.confidence || 'medium',\n          data: metadata\n        });\n      } catch (error) {\n        console.warn('PNGè§£æå¤±è´¥:', error);\n        resolve(null);\n      }\n    };\n    \n    reader.onerror = () => resolve(null);\n    reader.readAsArrayBuffer(file);\n  });\n}\n\n// ç®€åŒ–çš„PNGå—è§£æ\nfunction parsePNGChunks(buffer) {\n  const view = new DataView(buffer);\n  const chunks = [];\n  let offset = 8; // è·³è¿‡PNGç­¾å\n\n  // éªŒè¯PNGç­¾å\n  const signature = [0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A];\n  for (let i = 0; i < 8; i++) {\n    if (view.getUint8(i) !== signature[i]) {\n      throw new Error('ä¸æ˜¯æœ‰æ•ˆçš„PNGæ–‡ä»¶');\n    }\n  }\n\n  while (offset < buffer.byteLength - 8) {\n    try {\n      const length = view.getUint32(offset);\n      offset += 4;\n\n      const type = String.fromCharCode(\n        view.getUint8(offset),\n        view.getUint8(offset + 1),\n        view.getUint8(offset + 2),\n        view.getUint8(offset + 3)\n      );\n      offset += 4;\n\n      const data = new Uint8Array(buffer, offset, length);\n      offset += length;\n\n      const crc = view.getUint32(offset);\n      offset += 4;\n\n      chunks.push({ type, length, data, crc });\n\n      if (type === 'IEND') break;\n    } catch (error) {\n      console.warn('PNGå—è§£æè­¦å‘Š:', error);\n      break;\n    }\n  }\n\n  return chunks;\n}\n\n// ä»PNGå—æå–å…ƒæ•°æ®\nfunction extractMetadataFromChunks(chunks) {\n  const textChunks = chunks.filter(chunk => \n    ['tEXt', 'iTXt', 'zTXt'].includes(chunk.type)\n  );\n\n  const metadata = {\n    confidence: 'low',\n    generationTool: 'Unknown',\n    positive: '',\n    negative: '',\n    parameters: {}\n  };\n\n  for (const chunk of textChunks) {\n    const textData = parseTextChunk(chunk);\n    if (!textData.keyword || !textData.text) continue;\n\n    console.log('è§£ææ–‡æœ¬å—:', textData.keyword, 'é•¿åº¦:', textData.text.length);\n\n    // æ£€æµ‹ä¸åŒæ ¼å¼\n    if (textData.keyword === 'parameters' && isAutomatic1111Format(textData.text)) {\n      const parsed = parseAutomatic1111(textData.text);\n      Object.assign(metadata, parsed);\n      metadata.generationTool = 'AUTOMATIC1111';\n      metadata.confidence = 'high';\n    } else if (['workflow', 'prompt'].includes(textData.keyword)) {\n      try {\n        const parsed = parseComfyUI(textData.text);\n        Object.assign(metadata, parsed);\n        metadata.generationTool = 'ComfyUI';\n        metadata.confidence = 'high';\n      } catch (error) {\n        console.warn('ComfyUIè§£æå¤±è´¥:', error);\n      }\n    } else if (['Description', 'Comment'].includes(textData.keyword)) {\n      try {\n        const parsed = parseNovelAI(textData.text);\n        Object.assign(metadata, parsed);\n        metadata.generationTool = 'NovelAI';\n        metadata.confidence = 'high';\n      } catch (error) {\n        console.warn('NovelAIè§£æå¤±è´¥:', error);\n      }\n    }\n  }\n\n  return metadata;\n}\n\n// è§£ææ–‡æœ¬å—\nfunction parseTextChunk(chunk) {\n  try {\n    const data = chunk.data;\n    \n    if (chunk.type === 'tEXt') {\n      const nullIndex = data.indexOf(0);\n      if (nullIndex === -1) return {};\n\n      const keyword = decodeLatin1(data.slice(0, nullIndex));\n      const text = decodeLatin1(data.slice(nullIndex + 1));\n      return { keyword, text };\n    }\n    \n    if (chunk.type === 'iTXt') {\n      const nullIndices = [];\n      for (let i = 0; i < data.length; i++) {\n        if (data[i] === 0) {\n          nullIndices.push(i);\n          if (nullIndices.length >= 4) break;\n        }\n      }\n\n      if (nullIndices.length < 4) return {};\n\n      const keyword = decodeUTF8(data.slice(0, nullIndices[0]));\n      const text = decodeUTF8(data.slice(nullIndices[3] + 1));\n      return { keyword, text };\n    }\n    \n    return {};\n  } catch (error) {\n    console.warn('æ–‡æœ¬å—è§£æå¤±è´¥:', error);\n    return {};\n  }\n}\n\n// å®‰å…¨çš„å­—ç¬¦è§£ç \nfunction decodeLatin1(data) {\n  let result = '';\n  for (let i = 0; i < data.length; i++) {\n    result += String.fromCharCode(data[i]);\n  }\n  return result;\n}\n\nfunction decodeUTF8(data) {\n  try {\n    return new TextDecoder('utf-8', { fatal: false }).decode(data);\n  } catch (error) {\n    return decodeLatin1(data);\n  }\n}\n\n// æ£€æµ‹AUTOMATIC1111æ ¼å¼\nfunction isAutomatic1111Format(text) {\n  const lowerText = text.toLowerCase();\n  return lowerText.includes('steps:') || \n         lowerText.includes('cfg scale:') || \n         lowerText.includes('sampler:') || \n         lowerText.includes('negative prompt:');\n}\n\n// è§£æAUTOMATIC1111æ•°æ®\nfunction parseAutomatic1111(text) {\n  const result = {\n    positive: '',\n    negative: '',\n    parameters: {}\n  };\n\n  try {\n    const negativeIndex = text.indexOf('Negative prompt:');\n    \n    if (negativeIndex !== -1) {\n      result.positive = text.substring(0, negativeIndex).trim();\n      \n      const afterNegative = text.substring(negativeIndex + 16);\n      const lines = afterNegative.split('\\n');\n      \n      let negativePrompt = '';\n      let parameterLines = [];\n      let foundParams = false;\n      \n      for (const line of lines) {\n        const trimmed = line.trim();\n        if (isParameterLine(trimmed)) {\n          foundParams = true;\n          parameterLines.push(trimmed);\n        } else if (!foundParams && trimmed) {\n          negativePrompt += (negativePrompt ? '\\n' : '') + trimmed;\n        } else if (foundParams) {\n          parameterLines.push(trimmed);\n        }\n      }\n      \n      result.negative = negativePrompt.trim();\n      \n      if (parameterLines.length > 0) {\n        result.parameters = parseParameters(parameterLines.join(', '));\n      }\n    } else {\n      // æ²¡æœ‰è´Ÿå‘æç¤ºè¯çš„æƒ…å†µ\n      const lines = text.split('\\n');\n      let positiveLines = [];\n      let parameterLines = [];\n      let foundParams = false;\n      \n      for (const line of lines) {\n        const trimmed = line.trim();\n        if (isParameterLine(trimmed)) {\n          foundParams = true;\n          parameterLines.push(trimmed);\n        } else if (!foundParams && trimmed) {\n          positiveLines.push(trimmed);\n        } else if (foundParams) {\n          parameterLines.push(trimmed);\n        }\n      }\n      \n      result.positive = positiveLines.join(' ').trim();\n      \n      if (parameterLines.length > 0) {\n        result.parameters = parseParameters(parameterLines.join(', '));\n      }\n    }\n  } catch (error) {\n    console.warn('AUTOMATIC1111è§£æè­¦å‘Š:', error);\n    result.positive = text;\n  }\n\n  return result;\n}\n\n// æ£€æµ‹å‚æ•°è¡Œ\nfunction isParameterLine(line) {\n  return /\\b(Steps|Sampler|CFG scale|Seed|Size|Model):/i.test(line);\n}\n\n// è§£æå‚æ•°\nfunction parseParameters(paramText) {\n  const parameters = {};\n  const regex = /(\\w+(?:\\s+\\w+)*)\\s*:\\s*([^,]+?)(?=,\\s*\\w+\\s*:|$)/g;\n  let match;\n\n  while ((match = regex.exec(paramText)) !== null) {\n    const key = match[1].trim().toLowerCase().replace(/\\s+/g, '');\n    const value = match[2].trim();\n    \n    const numValue = parseFloat(value);\n    parameters[key] = !isNaN(numValue) && isFinite(numValue) ? numValue : value;\n  }\n\n  return parameters;\n}\n\n// è§£æComfyUIæ•°æ®\nfunction parseComfyUI(text) {\n  const result = {\n    positive: '',\n    negative: '',\n    parameters: {}\n  };\n\n  try {\n    const data = JSON.parse(text);\n    \n    if (Array.isArray(data?.nodes)) {\n      // å·¥ä½œæµæ ¼å¼\n      console.log('ğŸ“‹ æ£€æµ‹åˆ°ComfyUIå·¥ä½œæµæ ¼å¼');\n      const prompts = extractFromComfyWorkflow(data);\n      result.positive = prompts.positive;\n      result.negative = prompts.negative;\n      Object.assign(result.parameters, prompts.parameters);\n    } else if (typeof data === 'object') {\n      // æç¤ºæ ¼å¼\n      console.log('ğŸ“‹ æ£€æµ‹åˆ°ComfyUIæç¤ºæ ¼å¼');\n      const prompts = extractFromComfyPrompt(data);\n      result.positive = prompts.positive;\n      result.negative = prompts.negative;\n      Object.assign(result.parameters, prompts.parameters);\n    }\n    \n    // å¦‚æœæ²¡æœ‰æå–åˆ°æç¤ºè¯ï¼Œå°è¯•æ·±åº¦æœç´¢\n    if (!result.positive && !result.negative) {\n      console.log('ğŸ” å¼€å§‹æ·±åº¦æœç´¢æç¤ºè¯...');\n      const deepSearch = deepSearchPrompts(data);\n      result.positive = deepSearch.positive;\n      result.negative = deepSearch.negative;\n      Object.assign(result.parameters, deepSearch.parameters);\n    }\n    \n  } catch (error) {\n    console.warn('ComfyUIè§£æå¤±è´¥:', error);\n  }\n\n  return result;\n}\n\n// æ·±åº¦æœç´¢æç¤ºè¯ï¼ˆç”¨äºå¤æ‚å·¥ä½œæµï¼‰\nfunction deepSearchPrompts(data) {\n  const result = {\n    positive: '',\n    negative: '',\n    parameters: {}\n  };\n  \n  const allTexts = [];\n  \n  // é€’å½’æœç´¢æ‰€æœ‰å¯èƒ½åŒ…å«æ–‡æœ¬çš„å­—æ®µ\n  function searchObject(obj, path = '') {\n    if (typeof obj === 'string' && obj.trim().length > 10) {\n      // è¿‡æ»¤æ‰æ˜æ˜¾ä¸æ˜¯æç¤ºè¯çš„æ–‡æœ¬\n      if (!isSystemText(obj)) {\n        allTexts.push({\n          text: obj.trim(),\n          path: path,\n          length: obj.trim().length\n        });\n        console.log(`ğŸ” å‘ç°æ–‡æœ¬ (${path}): ${obj.substring(0, 50)}...`);\n      }\n    } else if (Array.isArray(obj)) {\n      obj.forEach((item, index) => {\n        searchObject(item, `${path}[${index}]`);\n      });\n    } else if (typeof obj === 'object' && obj !== null) {\n      Object.entries(obj).forEach(([key, value]) => {\n        // é‡ç‚¹å…³æ³¨å¯èƒ½åŒ…å«æç¤ºè¯çš„å­—æ®µ\n        const importantKeys = ['text', 'prompt', 'string', 'content', 'value', 'input', 'output'];\n        const newPath = importantKeys.includes(key.toLowerCase()) ? `${path}.${key}*` : `${path}.${key}`;\n        searchObject(value, newPath);\n      });\n    }\n  }\n  \n  searchObject(data);\n  \n  // æŒ‰é•¿åº¦æ’åºï¼Œä¼˜å…ˆå¤„ç†è¾ƒé•¿çš„æ–‡æœ¬ï¼ˆå¯èƒ½æ˜¯æœ€ç»ˆç»“æœï¼‰\n  allTexts.sort((a, b) => b.length - a.length);\n  \n  console.log(`ğŸ¯ å…±å‘ç° ${allTexts.length} ä¸ªæ–‡æœ¬ç‰‡æ®µ`);\n  \n  // æ™ºèƒ½åˆ†ç±»æ–‡æœ¬\n  const positiveTexts = [];\n  const negativeTexts = [];\n  \n  for (const textObj of allTexts) {\n    const text = textObj.text;\n    \n    // è·³è¿‡é‡å¤çš„æ–‡æœ¬\n    if (positiveTexts.some(t => t.includes(text) || text.includes(t)) ||\n        negativeTexts.some(t => t.includes(text) || text.includes(t))) {\n      continue;\n    }\n    \n    if (isNegativePrompt(text)) {\n      negativeTexts.push(text);\n      console.log(`â– åˆ†ç±»ä¸ºè´Ÿå‘: ${text.substring(0, 30)}...`);\n    } else {\n      positiveTexts.push(text);\n      console.log(`â• åˆ†ç±»ä¸ºæ­£å‘: ${text.substring(0, 30)}...`);\n    }\n  }\n  \n  // é€‰æ‹©æœ€ä½³æ–‡æœ¬\n  result.positive = selectBestPrompt(positiveTexts);\n  result.negative = selectBestPrompt(negativeTexts);\n  \n  return result;\n}\n\n// åˆ¤æ–­æ˜¯å¦ä¸ºç³»ç»Ÿæ–‡æœ¬ï¼ˆéæç¤ºè¯ï¼‰\nfunction isSystemText(text) {\n  const systemPatterns = [\n    /^[a-f0-9]{8,}$/i,  // å“ˆå¸Œå€¼\n    /^\\d+\\.\\d+\\.\\d+/,   // ç‰ˆæœ¬å·\n    /^https?:\\/\\//,     // URL\n    /^[A-Z_]+$/,        // å…¨å¤§å†™å¸¸é‡\n    /^\\w+\\.(png|jpg|jpeg|webp|gif)$/i,  // æ–‡ä»¶å\n    /^(true|false|null|undefined)$/i,   // å¸ƒå°”å€¼\n    /^\\d+x\\d+$/,        // å°ºå¯¸\n    /^#[a-f0-9]{6}$/i,  // é¢œè‰²ä»£ç \n  ];\n  \n  return systemPatterns.some(pattern => pattern.test(text.trim()));\n}\n\n// é€‰æ‹©æœ€ä½³æç¤ºè¯\nfunction selectBestPrompt(texts) {\n  if (texts.length === 0) return '';\n  if (texts.length === 1) return texts[0];\n  \n  // è¯„åˆ†ç³»ç»Ÿ\n  const scoredTexts = texts.map(text => {\n    let score = 0;\n    \n    // é•¿åº¦åŠ åˆ†ï¼ˆä½†ä¸æ˜¯è¶Šé•¿è¶Šå¥½ï¼‰\n    const idealLength = 200;\n    const lengthScore = Math.max(0, 1 - Math.abs(text.length - idealLength) / idealLength);\n    score += lengthScore * 0.3;\n    \n    // é€—å·æ•°é‡åŠ åˆ†ï¼ˆè¡¨ç¤ºæ ‡ç­¾ä¸°å¯Œåº¦ï¼‰\n    const commaCount = (text.match(/,/g) || []).length;\n    score += Math.min(commaCount / 10, 1) * 0.2;\n    \n    // åŒ…å«è´¨é‡è¯åŠ åˆ†\n    const qualityWords = ['masterpiece', 'best quality', 'high quality', 'detailed', 'professional'];\n    const qualityScore = qualityWords.filter(word => \n      text.toLowerCase().includes(word)\n    ).length / qualityWords.length;\n    score += qualityScore * 0.2;\n    \n    // åŒ…å«è‰ºæœ¯é£æ ¼è¯åŠ åˆ†\n    const styleWords = ['anime', 'realistic', 'painting', 'illustration', 'digital art', 'concept art'];\n    const styleScore = styleWords.filter(word => \n      text.toLowerCase().includes(word)\n    ).length / styleWords.length;\n    score += styleScore * 0.1;\n    \n    // é¿å…é‡å¤è¯æ±‡\n    const words = text.toLowerCase().split(/\\s+/);\n    const uniqueWords = new Set(words);\n    const uniqueRatio = uniqueWords.size / words.length;\n    score += uniqueRatio * 0.2;\n    \n    return { text, score };\n  });\n  \n  // é€‰æ‹©å¾—åˆ†æœ€é«˜çš„\n  scoredTexts.sort((a, b) => b.score - a.score);\n  const best = scoredTexts[0];\n  \n  console.log(`ğŸ† é€‰æ‹©æœ€ä½³æç¤ºè¯ (å¾—åˆ†: ${best.score.toFixed(2)}): ${best.text.substring(0, 50)}...`);\n  \n  return best.text;\n}\n\n// ä»ComfyUIå·¥ä½œæµæå–\nfunction extractFromComfyWorkflow(workflow) {\n  const positivePrompts = [];\n  const negativePrompts = [];\n  const parameters = {};\n\n  console.log('ğŸ” åˆ†æComfyUIå·¥ä½œæµï¼ŒèŠ‚ç‚¹æ•°é‡:', workflow.nodes?.length || 0);\n\n  for (const node of workflow.nodes || []) {\n    console.log(`ğŸ“ æ£€æŸ¥èŠ‚ç‚¹: ${node.type} (${node.title || 'untitled'})`);\n    \n    // æ‰©å±•æ”¯æŒçš„æ–‡æœ¬ç¼–ç èŠ‚ç‚¹ç±»å‹\n    const textEncoderTypes = [\n      'CLIPTextEncode', \n      'CLIPTextEncodeSDXL',\n      'BNK_CLIPTextEncoder',  // BNKç³»åˆ—èŠ‚ç‚¹\n      'WeiLin-ComfyUI-prompt-all-in-one',  // WeiLinæ’ä»¶\n      'TIPO',  // TIPOèŠ‚ç‚¹\n      'PromptWithStyle',  // æ ·å¼æç¤ºè¯èŠ‚ç‚¹\n      'StringFunction',  // å­—ç¬¦ä¸²å¤„ç†èŠ‚ç‚¹\n      'Text',  // é€šç”¨æ–‡æœ¬èŠ‚ç‚¹\n      'TextInput',  // æ–‡æœ¬è¾“å…¥èŠ‚ç‚¹\n      'PromptBuilder',  // æç¤ºè¯æ„å»ºå™¨\n      'AdvancedCLIPTextEncode',  // é«˜çº§CLIPç¼–ç å™¨\n      'CLIPTextEncodeFlux',  // Fluxæ¨¡å‹ç¼–ç å™¨\n      'ShowText',  // æ˜¾ç¤ºæ–‡æœ¬èŠ‚ç‚¹\n      'StringConstant',  // å­—ç¬¦ä¸²å¸¸é‡\n      'MultilineStringLiteral'  // å¤šè¡Œå­—ç¬¦ä¸²\n    ];\n\n    if (textEncoderTypes.includes(node.type)) {\n      console.log(`âœ… æ‰¾åˆ°æ–‡æœ¬ç¼–ç èŠ‚ç‚¹: ${node.type}`);\n      \n      // å°è¯•å¤šç§æ–¹å¼è·å–æ–‡æœ¬å†…å®¹\n      let text = null;\n      \n      // æ–¹å¼1: widgets_valuesæ•°ç»„\n      if (node.widgets_values && Array.isArray(node.widgets_values)) {\n        for (const value of node.widgets_values) {\n          if (typeof value === 'string' && value.trim().length > 0) {\n            text = value.trim();\n            console.log(`ğŸ“„ ä»widgets_valuesè·å–æ–‡æœ¬: ${text.substring(0, 50)}...`);\n            break;\n          }\n        }\n      }\n      \n      // æ–¹å¼2: ç›´æ¥çš„textå±æ€§\n      if (!text && node.text && typeof node.text === 'string') {\n        text = node.text.trim();\n        console.log(`ğŸ“„ ä»textå±æ€§è·å–æ–‡æœ¬: ${text.substring(0, 50)}...`);\n      }\n      \n      // æ–¹å¼3: inputsä¸­çš„text\n      if (!text && node.inputs) {\n        for (const input of node.inputs) {\n          if (input.name === 'text' && input.widget && input.widget.value) {\n            text = input.widget.value.trim();\n            console.log(`ğŸ“„ ä»inputsè·å–æ–‡æœ¬: ${text.substring(0, 50)}...`);\n            break;\n          }\n        }\n      }\n      \n      // æ–¹å¼4: propertiesä¸­æŸ¥æ‰¾\n      if (!text && node.properties) {\n        if (node.properties.text) {\n          text = node.properties.text.trim();\n          console.log(`ğŸ“„ ä»propertiesè·å–æ–‡æœ¬: ${text.substring(0, 50)}...`);\n        }\n      }\n      \n      if (text && text.length > 0) {\n        // æ™ºèƒ½åˆ¤æ–­æ˜¯å¦ä¸ºè´Ÿå‘æç¤ºè¯\n        const isNegative = isNegativePrompt(text) || \n                          node.title?.toLowerCase().includes('negative') ||\n                          node.title?.toLowerCase().includes('è´Ÿå‘') ||\n                          node.title?.toLowerCase().includes('åå‘') ||\n                          (node.color && (node.color === '#ff6b6b' || node.color === '#e74c3c')); // çº¢è‰²é€šå¸¸è¡¨ç¤ºè´Ÿå‘\n        \n        if (isNegative) {\n          negativePrompts.push(text);\n          console.log(`â– è¯†åˆ«ä¸ºè´Ÿå‘æç¤ºè¯: ${text.substring(0, 30)}...`);\n        } else {\n          positivePrompts.push(text);\n          console.log(`â• è¯†åˆ«ä¸ºæ­£å‘æç¤ºè¯: ${text.substring(0, 30)}...`);\n        }\n      }\n    }\n    \n    // æå–é‡‡æ ·å™¨å‚æ•°\n    if (['KSampler', 'KSamplerAdvanced', 'SamplerCustom'].includes(node.type)) {\n      if (node.widgets_values) {\n        const [seed, steps, cfg, sampler_name, scheduler, denoise] = node.widgets_values;\n        if (seed !== undefined) parameters.seed = seed;\n        if (steps !== undefined) parameters.steps = steps;\n        if (cfg !== undefined) parameters.cfg_scale = cfg;\n        if (sampler_name !== undefined) parameters.sampler = sampler_name;\n        if (scheduler !== undefined) parameters.scheduler = scheduler;\n        if (denoise !== undefined) parameters.denoise = denoise;\n        console.log(`âš™ï¸ æå–é‡‡æ ·å™¨å‚æ•°: steps=${steps}, cfg=${cfg}, sampler=${sampler_name}`);\n      }\n    }\n    \n    // æå–æ¨¡å‹ä¿¡æ¯\n    if (['CheckpointLoaderSimple', 'CheckpointLoader'].includes(node.type)) {\n      if (node.widgets_values && node.widgets_values[0]) {\n        parameters.model = node.widgets_values[0];\n        console.log(`ğŸ¯ æå–æ¨¡å‹: ${parameters.model}`);\n      }\n    }\n    \n    // æå–å›¾åƒå°ºå¯¸\n    if (['EmptyLatentImage', 'LatentUpscale'].includes(node.type)) {\n      if (node.widgets_values) {\n        const [width, height] = node.widgets_values;\n        if (width !== undefined) parameters.width = width;\n        if (height !== undefined) parameters.height = height;\n        console.log(`ğŸ“ æå–å°ºå¯¸: ${width}x${height}`);\n      }\n    }\n  }\n\n  // æ™ºèƒ½åˆå¹¶æç¤ºè¯\n  const finalPositive = smartMergePrompts(positivePrompts);\n  const finalNegative = smartMergePrompts(negativePrompts);\n  \n  console.log(`ğŸ¯ æœ€ç»ˆç»“æœ: æ­£å‘æç¤ºè¯${finalPositive.length}å­—ç¬¦, è´Ÿå‘æç¤ºè¯${finalNegative.length}å­—ç¬¦`);\n\n  return {\n    positive: finalPositive,\n    negative: finalNegative,\n    parameters\n  };\n}\n\n// æ™ºèƒ½åˆå¹¶æç¤ºè¯\nfunction smartMergePrompts(prompts) {\n  if (prompts.length === 0) return '';\n  if (prompts.length === 1) return prompts[0];\n  \n  // å»é‡å¹¶æŒ‰é•¿åº¦æ’åºï¼Œä¼˜å…ˆé€‰æ‹©æ›´å®Œæ•´çš„æç¤ºè¯\n  const uniquePrompts = [...new Set(prompts)];\n  uniquePrompts.sort((a, b) => b.length - a.length);\n  \n  // å¦‚æœæœ€é•¿çš„æç¤ºè¯æ˜æ˜¾æ¯”å…¶ä»–çš„é•¿å¾ˆå¤šï¼Œå¯èƒ½æ˜¯æœ€ç»ˆåˆæˆçš„ç»“æœ\n  const longest = uniquePrompts[0];\n  const secondLongest = uniquePrompts[1] || '';\n  \n  if (longest.length > secondLongest.length * 2) {\n    console.log(`ğŸ¯ é€‰æ‹©æœ€é•¿æç¤ºè¯ä½œä¸ºæœ€ç»ˆç»“æœ: ${longest.length} vs ${secondLongest.length}`);\n    return longest;\n  }\n  \n  // å¦åˆ™åˆå¹¶æ‰€æœ‰å”¯ä¸€çš„æç¤ºè¯\n  return uniquePrompts.join(', ');\n}\n\n// ä»ComfyUIæç¤ºæå–\nfunction extractFromComfyPrompt(prompt) {\n  const positivePrompts = [];\n  const negativePrompts = [];\n  const parameters = {};\n\n  console.log('ğŸ” åˆ†æComfyUIæç¤ºæ ¼å¼ï¼ŒèŠ‚ç‚¹æ•°é‡:', Object.keys(prompt).length);\n\n  for (const [nodeId, nodeData] of Object.entries(prompt)) {\n    console.log(`ğŸ“ æ£€æŸ¥èŠ‚ç‚¹ ${nodeId}: ${nodeData.class_type}`);\n    \n    // æ‰©å±•æ”¯æŒçš„èŠ‚ç‚¹ç±»å‹\n    const textEncoderTypes = [\n      'CLIPTextEncode', \n      'CLIPTextEncodeSDXL',\n      'BNK_CLIPTextEncoder',\n      'WeiLin-ComfyUI-prompt-all-in-one',\n      'TIPO',\n      'PromptWithStyle',\n      'StringFunction',\n      'Text',\n      'TextInput',\n      'PromptBuilder',\n      'AdvancedCLIPTextEncode',\n      'CLIPTextEncodeFlux',\n      'ShowText',\n      'StringConstant',\n      'MultilineStringLiteral'\n    ];\n    \n    if (textEncoderTypes.includes(nodeData.class_type)) {\n      console.log(`âœ… æ‰¾åˆ°æ–‡æœ¬ç¼–ç èŠ‚ç‚¹: ${nodeData.class_type}`);\n      \n      // å°è¯•å¤šç§æ–¹å¼è·å–æ–‡æœ¬\n      let text = null;\n      \n      if (nodeData.inputs?.text && typeof nodeData.inputs.text === 'string') {\n        text = nodeData.inputs.text.trim();\n        console.log(`ğŸ“„ ä»inputs.textè·å–: ${text.substring(0, 50)}...`);\n      } else if (nodeData.inputs?.prompt && typeof nodeData.inputs.prompt === 'string') {\n        text = nodeData.inputs.prompt.trim();\n        console.log(`ğŸ“„ ä»inputs.promptè·å–: ${text.substring(0, 50)}...`);\n      } else if (nodeData.inputs?.string && typeof nodeData.inputs.string === 'string') {\n        text = nodeData.inputs.string.trim();\n        console.log(`ğŸ“„ ä»inputs.stringè·å–: ${text.substring(0, 50)}...`);\n      }\n      \n      if (text && text.length > 0) {\n        if (isNegativePrompt(text)) {\n          negativePrompts.push(text);\n          console.log(`â– è¯†åˆ«ä¸ºè´Ÿå‘æç¤ºè¯`);\n        } else {\n          positivePrompts.push(text);\n          console.log(`â• è¯†åˆ«ä¸ºæ­£å‘æç¤ºè¯`);\n        }\n      }\n    }\n    \n    // æå–å…¶ä»–å‚æ•°...\n    if (['KSampler', 'KSamplerAdvanced', 'SamplerCustom'].includes(nodeData.class_type)) {\n      const inputs = nodeData.inputs;\n      if (inputs.seed !== undefined) parameters.seed = inputs.seed;\n      if (inputs.steps !== undefined) parameters.steps = inputs.steps;\n      if (inputs.cfg !== undefined) parameters.cfg_scale = inputs.cfg;\n      if (inputs.sampler_name !== undefined) parameters.sampler = inputs.sampler_name;\n      if (inputs.scheduler !== undefined) parameters.scheduler = inputs.scheduler;\n      if (inputs.denoise !== undefined) parameters.denoise = inputs.denoise;\n    }\n  }\n\n  const finalPositive = smartMergePrompts(positivePrompts);\n  const finalNegative = smartMergePrompts(negativePrompts);\n  \n  console.log(`ğŸ¯ æœ€ç»ˆç»“æœ: æ­£å‘æç¤ºè¯${finalPositive.length}å­—ç¬¦, è´Ÿå‘æç¤ºè¯${finalNegative.length}å­—ç¬¦`);\n\n  return {\n    positive: finalPositive,\n    negative: finalNegative,\n    parameters\n  };\n}\n\n// æ£€æµ‹è´Ÿå‘æç¤ºè¯\nfunction isNegativePrompt(text) {\n  const lowerText = text.toLowerCase();\n  \n  // æ‰©å±•è´Ÿå‘å…³é”®è¯åˆ—è¡¨\n  const negativeKeywords = [\n    // è´¨é‡ç›¸å…³\n    'worst quality', 'bad quality', 'low quality', 'poor quality',\n    'bad anatomy', 'bad proportions', 'bad hands', 'bad fingers',\n    'ugly', 'deformed', 'disfigured', 'mutated', 'malformed',\n    'blurry', 'blur', 'out of focus', 'unfocused', 'soft focus',\n    'lowres', 'low resolution', 'pixelated', 'jpeg artifacts',\n    \n    // æŠ€æœ¯é—®é¢˜\n    'error', 'glitch', 'artifact', 'noise', 'grain', 'distorted',\n    'cropped', 'cut off', 'truncated', 'incomplete',\n    'watermark', 'signature', 'text', 'logo', 'username',\n    'border', 'frame', 'black bars', 'letterbox',\n    \n    // è§£å‰–é—®é¢˜\n    'extra limbs', 'missing limbs', 'extra fingers', 'missing fingers',\n    'extra arms', 'extra legs', 'fused fingers', 'too many fingers',\n    'long neck', 'long body', 'elongated', 'stretched',\n    'duplicate', 'multiple', 'conjoined', 'merged',\n    \n    // é£æ ¼é—®é¢˜\n    'amateur', 'sketch', 'draft', 'unfinished', 'rough',\n    'simple', 'basic', 'plain', 'boring', 'dull',\n    'monochrome', 'grayscale', 'black and white', 'sepia',\n    \n    // å†…å®¹é—®é¢˜\n    'nsfw', 'nude', 'naked', 'explicit', 'sexual',\n    'violence', 'blood', 'gore', 'disturbing', 'scary',\n    'dark', 'horror', 'nightmare', 'creepy', 'evil',\n    \n    // ä¸­æ–‡è´Ÿå‘è¯\n    'æœ€å·®è´¨é‡', 'ç³Ÿç³•è´¨é‡', 'ä½è´¨é‡', 'å·®è´¨é‡',\n    'ç³Ÿç³•è§£å‰–', 'å˜å½¢', 'ç•¸å½¢', 'ä¸‘é™‹', 'æ¨¡ç³Š',\n    'ä½åˆ†è¾¨ç‡', 'åƒç´ åŒ–', 'å™ªç‚¹', 'ä¼ªå½±',\n    'æ°´å°', 'ç­¾å', 'æ–‡å­—', 'æ ‡å¿—', 'ç”¨æˆ·å',\n    'å¤šä½™çš„', 'ç¼ºå¤±çš„', 'èåˆçš„', 'é‡å¤çš„',\n    'ä¸šä½™', 'è‰å›¾', 'æœªå®Œæˆ', 'ç²—ç³™', 'ç®€å•',\n    'å•è‰²', 'ç°åº¦', 'é»‘ç™½', 'æš—è‰²è°ƒ'\n  ];\n  \n  // æ£€æŸ¥æ˜¯å¦åŒ…å«è´Ÿå‘å…³é”®è¯\n  const hasNegativeKeywords = negativeKeywords.some(keyword => \n    lowerText.includes(keyword.toLowerCase())\n  );\n  \n  // æ£€æŸ¥è´Ÿå‘æç¤ºè¯çš„æ¯”ä¾‹\n  const negativeWordCount = negativeKeywords.filter(keyword => \n    lowerText.includes(keyword.toLowerCase())\n  ).length;\n  \n  const totalWords = text.split(/\\s+/).length;\n  const negativeRatio = negativeWordCount / totalWords;\n  \n  // å¦‚æœè´Ÿå‘è¯æ±‡æ¯”ä¾‹è¶…è¿‡30%ï¼Œå¾ˆå¯èƒ½æ˜¯è´Ÿå‘æç¤ºè¯\n  const isHighNegativeRatio = negativeRatio > 0.3;\n  \n  // æ£€æŸ¥æ˜¯å¦ä»¥è´Ÿå‘è¯å¼€å¤´\n  const startsWithNegative = negativeKeywords.some(keyword => \n    lowerText.startsWith(keyword.toLowerCase())\n  );\n  \n  console.log(`ğŸ” è´Ÿå‘æ£€æµ‹: å…³é”®è¯=${hasNegativeKeywords}, æ¯”ä¾‹=${negativeRatio.toFixed(2)}, å¼€å¤´=${startsWithNegative}`);\n  \n  return hasNegativeKeywords || isHighNegativeRatio || startsWithNegative;\n}\n\n// è§£æNovelAIæ•°æ®\nfunction parseNovelAI(text) {\n  const result = {\n    positive: '',\n    negative: '',\n    parameters: {}\n  };\n\n  try {\n    const data = JSON.parse(text);\n    result.positive = data.prompt || '';\n    result.negative = data.uc || '';\n    \n    ['steps', 'scale', 'seed', 'sampler', 'width', 'height'].forEach(key => {\n      if (data[key] !== undefined) {\n        result.parameters[key] = data[key];\n      }\n    });\n  } catch (error) {\n    console.warn('NovelAIè§£æå¤±è´¥:', error);\n  }\n\n  return result;\n}\n\n// EXIFæ•°æ®æå–\nasync function extractFromEXIF(file) {\n  try {\n    // åŠ¨æ€å¯¼å…¥exifr\n    const exifr = await import('exifr');\n    \n    const exifData = await exifr.parse(file, {\n      userComment: true,\n      imageDescription: true,\n      software: true\n    });\n\n    if (!exifData) return null;\n\n    return {\n      type: 'EXIF',\n      confidence: 'medium',\n      data: {\n        software: exifData.Software,\n        description: exifData.ImageDescription,\n        userComment: exifData.UserComment,\n        positive: exifData.UserComment || exifData.ImageDescription || '',\n        negative: '',\n        parameters: {}\n      }\n    };\n  } catch (error) {\n    console.warn('EXIFæå–å¤±è´¥:', error);\n    return null;\n  }\n}\n\n// æ ‡å‡†åŒ–æ•°æ®\nfunction standardizeData(extractedData) {\n  const standardized = {\n    generationTool: 'Unknown',\n    positive: '',\n    negative: '',\n    parameters: {}\n  };\n\n  // ä¼˜å…ˆçº§é¡ºåº\n  const sources = ['PNG', 'EXIF'];\n  \n  for (const source of sources) {\n    const data = extractedData[source];\n    if (!data) continue;\n\n    if (data.data.generationTool) {\n      standardized.generationTool = data.data.generationTool;\n    }\n\n    if (data.data.positive && !standardized.positive) {\n      standardized.positive = data.data.positive;\n    }\n\n    if (data.data.negative && !standardized.negative) {\n      standardized.negative = data.data.negative;\n    }\n\n    Object.assign(standardized.parameters, data.data.parameters || {});\n  }\n\n  return standardized;\n}\n\n// å¯¼å‡ºä¸»è¦å‡½æ•°\nexport const imageMetadataExtractor = {\n  extractMetadata\n};\n\nexport default imageMetadataExtractor; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}